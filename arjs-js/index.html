<html>
<head>
    <meta charset="utf-8" />
    <title>ActiveReportsJS Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="node_modules/@grapecity/activereports/styles/ar-js-viewer.css" />
    <script type="text/javascript" src="node_modules/@grapecity/activereports/dist/ie-polyfills.js"></script> <!--to run in IE-->
    <script type="text/javascript" src="node_modules/@grapecity/activereports/dist/ar-js-core.js"></script>
    <script type="text/javascript" src="node_modules/@grapecity/activereports/dist/ar-js-viewer.js"></script>
    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
</head>
<body onload="load()">
    <div id="ARJSviewerDiv" style="height: 600px"></div>
    <script>
        function load() {
            const viewer = new ActiveReports.Viewer('#ARJSviewerDiv');
            var parameters = [];
            var customers = [];
            var products = [];
            var orders = [];
            var orderDetails = [];

            $.get("https://demodata.grapecity.com/northwind/api/v1/Customers", function (data) {
                customers = customers.concat(data);
                parameters.push({ Name: 'Customers', Value: [JSON.stringify(customers)] });
            })
                .done(function () {
                    $.get("https://demodata.grapecity.com/northwind/api/v1/Products", function (data) {
                        products = products.concat(data);
                        parameters.push({ Name: 'Products', Value: [JSON.stringify(products)] });
                    }).done(function () {
                        $.get("https://demodata.grapecity.com/northwind/api/Orders", function (data) {
                            orders = orders.concat(data);
                            var requests = [];
                            for (var i = 0; i < 20; i++) {
                                requests.push($.ajax({ url: "https://demodata.grapecity.com/northwind/api/v1/Orders/" + data[i].orderId + "/OrderDetails" }));
                            }

                            $.when.apply(undefined, requests).then(function () {
                                var objects = arguments;
                                var orderGroups = objects;
                                for (var i = 0; i < orderGroups.length; i++) {
                                    for (var j = 0; j < orderGroups[i][0].length; j++) {
                                        var orderDetail = orderGroups[i][0][j];

                                        const order = orders.find(element => element.orderId == orderDetail.orderId);
                                        orderDetail.orderId = order.orderId;
                                        orderDetail.customerId = order.customerId;
                                        orderDetail.employeeId = order.employeeId;
                                        orderDetail.orderDate = order.orderDate;
                                        orderDetail.requiredDate = order.requiredDate;
                                        orderDetail.shippedDate = order.shippedDate;
                                        orderDetail.shipVia = order.shipVia;
                                        orderDetail.freight = order.freight;
                                        orderDetail.shipName = order.shipName;
                                        orderDetail.shipAddress = order.shipAddress;
                                        orderDetail.shipCity = order.shipCity;
                                        orderDetail.shipRegion = order.shipRegion;
                                        orderDetail.shipPostalCode = order.shipPostalCode;
                                        orderDetail.shipCountry = order.shipCountry;

                                        orderDetails.push(orderDetail);
                                    }
                                }

                                parameters.push({ Name: 'Orders', Value: [JSON.stringify(orderDetails)] });
                                viewer.open('drill-down.rdlx-json', { ReportParams: parameters });
                            });
                        })
                    });
                });
        }
    </script>
</body>
</html>
